"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7841],{10081:(e,r,s)=>{s.d(r,{A:()=>t});let t=(0,s(31291).A)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},23226:(e,r,s)=>{s.d(r,{O:()=>i,a:()=>l});var t=s(46068),a=s(56104);async function i(e,r){if(!e||!r)throw Error("User ID and file must be provided.");let s=(0,t.KR)(a.IG,"profile-images/".concat(e,"/").concat(r.name));try{let e=await (0,t.D)(s,r);return await (0,t.qk)(e.ref)}catch(e){throw console.error("Firebase Storage Error:",e),e}}async function l(e,r){if(!e||!r)throw Error("Caterer ID and file must be provided.");let s="meal-images/".concat(e,"/").concat(Date.now(),"-").concat(r.name),i=(0,t.KR)(a.IG,s);try{let e=await (0,t.D)(i,r);return{downloadURL:await (0,t.qk)(e.ref),imagePath:s}}catch(e){throw console.error("Firebase Meal Image Storage Error:",e),e}}},27136:(e,r,s)=>{s.d(r,{A:()=>t});let t=(0,s(31291).A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},27841:(e,r,s)=>{s.r(r),s.d(r,{default:()=>$});var t=s(95155),a=s(12115),i=s(35695),l=s(29642),n=s(75288),c=s(52651),o=s(66766),d=s(30285),u=s(62523),m=s(59434);let p=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)("textarea",{className:(0,m.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:r,...a})});p.displayName="Textarea";var f=s(85057),x=s(66695),h=s(25646),g=s(97648),b=s(76714),v=s(33324),j=s(82790),y=s(65562),w=s(77868),k="Switch",[N,S]=(0,b.A)(k),[C,R]=N(k),A=a.forwardRef((e,r)=>{let{__scopeSwitch:s,name:i,checked:l,defaultChecked:n,required:c,disabled:o,value:d="on",onCheckedChange:u,form:m,...p}=e,[f,x]=a.useState(null),b=(0,g.s)(r,e=>x(e)),j=a.useRef(!1),y=!f||m||!!f.closest("form"),[N,S]=(0,v.i)({prop:l,defaultProp:null!=n&&n,onChange:u,caller:k});return(0,t.jsxs)(C,{scope:s,checked:N,disabled:o,children:[(0,t.jsx)(w.sG.button,{type:"button",role:"switch","aria-checked":N,"aria-required":c,"data-state":D(N),"data-disabled":o?"":void 0,disabled:o,value:d,...p,ref:b,onClick:(0,h.mK)(e.onClick,e=>{S(e=>!e),y&&(j.current=e.isPropagationStopped(),j.current||e.stopPropagation())})}),y&&(0,t.jsx)(E,{control:f,bubbles:!j.current,name:i,value:d,checked:N,required:c,disabled:o,form:m,style:{transform:"translateX(-100%)"}})]})});A.displayName=k;var I="SwitchThumb",M=a.forwardRef((e,r)=>{let{__scopeSwitch:s,...a}=e,i=R(I,s);return(0,t.jsx)(w.sG.span,{"data-state":D(i.checked),"data-disabled":i.disabled?"":void 0,...a,ref:r})});M.displayName=I;var E=a.forwardRef((e,r)=>{let{__scopeSwitch:s,control:i,checked:l,bubbles:n=!0,...c}=e,o=a.useRef(null),d=(0,g.s)(o,r),u=(0,j.Z)(l),m=(0,y.X)(i);return a.useEffect(()=>{let e=o.current;if(!e)return;let r=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(u!==l&&r){let s=new Event("click",{bubbles:n});r.call(e,l),e.dispatchEvent(s)}},[u,l,n]),(0,t.jsx)("input",{type:"checkbox","aria-hidden":!0,defaultChecked:l,...c,tabIndex:-1,ref:d,style:{...c.style,...m,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function D(e){return e?"checked":"unchecked"}E.displayName="SwitchBubbleInput";let F=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)(A,{className:(0,m.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...a,ref:r,children:(0,t.jsx)(M,{className:(0,m.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});F.displayName=A.displayName;var L=s(59409),J=s(87481),q=s(10081);let z=(0,s(31291).A)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);var P=s(27136),B=s(68938),T=s(6723),U=s(6844),V=s(23226),G=s(56104),H=s(46151),Z=s(89578);let K=c.Ik({name:c.Yj().min(1,"Le nom du repas est requis."),description:c.Yj().min(1,"La description est requise."),price:c.au.number().min(0,"Le prix doit \xeatre positif."),category:c.k5(["breakfast","lunch","dinner","snack"]),availability:c.zM().default(!0),calories:c.au.number().min(0,"Les calories sont requises."),protein:c.au.number().min(0,"Les prot\xe9ines sont requises."),carbs:c.au.number().min(0,"Les glucides sont requis."),fat:c.au.number().min(0,"Les lipides sont requis."),fibers:c.au.number().min(0).optional()});function $(e){var r,s,c,m,h;let{initialAnalysis:g}=e,b=(0,i.useRouter)(),{toast:v}=(0,J.dj)(),[j,y]=(0,a.useState)(!1),[w,k]=(0,a.useState)((null==g?void 0:g.ingredients)||[]),[N,S]=(0,a.useState)(null),[C,R]=(0,a.useState)(null),[A,I]=(0,a.useState)(null),M=(0,a.useRef)(null);(0,a.useEffect)(()=>{let e=(0,H.hg)(G.j2,e=>{e?I(e.uid):b.push("/login")});return()=>e()},[b]);let E=(0,l.mN)({resolver:(0,n.u)(K),defaultValues:{name:(null==g?void 0:g.mealName)||"",description:(null==g?void 0:g.description)||"",price:0,category:"lunch",availability:!0,calories:(null==g||null==(r=g.totalMacros)?void 0:r.calories)||0,protein:(null==g||null==(s=g.totalMacros)?void 0:s.protein)||0,carbs:(null==g||null==(c=g.totalMacros)?void 0:c.carbs)||0,fat:(null==g||null==(m=g.totalMacros)?void 0:m.fat)||0,fibers:(null==g||null==(h=g.totalMacros)?void 0:h.fibers)||0}});(0,a.useEffect)(()=>{(null==g?void 0:g.ingredients)&&k(g.ingredients)},[g]);let D=(e,r,s)=>{let t=[...w];"grams"===r&&"string"==typeof s?t[e][r]=parseInt(s,10)||0:t[e][r]=s,k(t)},$=e=>{k(w.filter((r,s)=>s!==e))},_=async e=>{if(!A)return void v({title:"Erreur d'authentification",description:"Utilisateur non connect\xe9.",variant:"destructive"});y(!0);try{let r,s="https://placehold.co/600x400.png";if(N){let e=await (0,V.a)(A,N);s=e.downloadURL,r=e.imagePath}let a={name:e.name,description:e.description,price:e.price,category:e.category,availability:e.availability,imageUrl:s,ingredients:w,calories:e.calories,macros:{protein:e.protein,carbs:e.carbs,fat:e.fat,fibers:e.fibers},createdBy:A};r&&(a.imageRef=r),await (0,U.Hg)(a),v({title:"Repas ajout\xe9!",description:"".concat(e.name," a \xe9t\xe9 ajout\xe9 avec succ\xe8s."),action:(0,t.jsx)(q.A,{className:"text-green-500"})}),b.push("/caterer")}catch(e){v({title:"Erreur de sauvegarde",description:"Impossible de sauvegarder le repas.",variant:"destructive"})}finally{y(!1)}};return(0,t.jsxs)("form",{onSubmit:E.handleSubmit(_),className:"space-y-6",children:[(0,t.jsxs)(d.$,{type:"button",variant:"outline",onClick:()=>b.push("/caterer/meal-ai"),className:"flex items-center gap-2",children:[(0,t.jsx)(Z.A,{className:"w-4 h-4"}),"Retour"]}),(0,t.jsx)("h4",{className:"text-2xl font-bold mb-4",children:"Etape 2 : V\xe9rifier les ingr\xe9dients"}),(0,t.jsxs)(x.Zp,{children:[(0,t.jsxs)(x.aR,{children:[(0,t.jsx)(x.ZB,{children:"D\xe9tails du Repas"}),(0,t.jsx)(x.BT,{children:"V\xe9rifiez et modifiez les informations propos\xe9es par l'IA."})]}),(0,t.jsxs)(x.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-col md:flex-row gap-6",children:[(0,t.jsxs)("div",{className:"w-full md:w-1/3 space-y-2",children:[(0,t.jsx)(f.J,{children:"Image du repas"}),(0,t.jsx)("div",{className:"relative aspect-video w-full bg-muted rounded-lg flex items-center justify-center border-2 border-dashed border-gray-300 cursor-pointer",onClick:()=>{var e;return null==(e=M.current)?void 0:e.click()},children:C?(0,t.jsx)(o.default,{src:C,layout:"fill",objectFit:"cover",alt:"Aper\xe7u du repas",className:"rounded-lg"}):(0,t.jsxs)("div",{className:"text-center text-muted-foreground p-4",children:[(0,t.jsx)(z,{className:"mx-auto h-8 w-8"}),(0,t.jsx)("p",{children:"Cliquez pour t\xe9l\xe9charger"})]})}),(0,t.jsx)("input",{type:"file",ref:M,onChange:e=>{var r;let s=null==(r=e.target.files)?void 0:r[0];if(s){S(s);let e=new FileReader;e.onloadend=()=>R(e.result),e.readAsDataURL(s)}},className:"hidden",accept:"image/*"})]}),(0,t.jsxs)("div",{className:"w-full md:w-2/3 space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(f.J,{htmlFor:"name",children:"Nom du repas"}),(0,t.jsx)(u.p,{id:"name",...E.register("name")}),E.formState.errors.name&&(0,t.jsx)("p",{className:"text-destructive text-sm mt-1",children:E.formState.errors.name.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(f.J,{htmlFor:"description",children:"Description"}),(0,t.jsx)(p,{id:"description",...E.register("description")}),E.formState.errors.description&&(0,t.jsx)("p",{className:"text-destructive text-sm mt-1",children:E.formState.errors.description.message})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 pt-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(f.J,{htmlFor:"price",children:"Prix (DT)"}),(0,t.jsx)(u.p,{id:"price",type:"number",step:"0.1",...E.register("price")}),E.formState.errors.price&&(0,t.jsx)("p",{className:"text-destructive text-sm mt-1",children:E.formState.errors.price.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(f.J,{htmlFor:"category",children:"Cat\xe9gorie"}),(0,t.jsx)(l.xI,{control:E.control,name:"category",render:e=>{let{field:r}=e;return(0,t.jsxs)(L.l6,{onValueChange:r.onChange,value:r.value,children:[(0,t.jsx)(L.bq,{children:(0,t.jsx)(L.yv,{})}),(0,t.jsxs)(L.gC,{children:[(0,t.jsx)(L.eb,{value:"breakfast",children:"Petit d\xe9jeuner"}),(0,t.jsx)(L.eb,{value:"lunch",children:"D\xe9jeuner"}),(0,t.jsx)(L.eb,{value:"dinner",children:"D\xeener"}),(0,t.jsx)(L.eb,{value:"snack",children:"Collation"})]})]})}})]}),(0,t.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,t.jsx)(f.J,{children:"Disponibilit\xe9"}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(l.xI,{control:E.control,name:"availability",render:e=>{let{field:r}=e;return(0,t.jsx)(F,{id:"availability",checked:r.value,onCheckedChange:r.onChange})}}),(0,t.jsx)("span",{children:E.watch("availability")?"Disponible":"Indisponible"})]})]})]})]})]}),(0,t.jsxs)(x.Zp,{children:[(0,t.jsxs)(x.aR,{children:[(0,t.jsx)(x.ZB,{children:"D\xe9tails Nutritionnels & Ingr\xe9dients"}),(0,t.jsx)(x.BT,{children:"Modifiez les macros et ingr\xe9dients g\xe9n\xe9r\xe9s."})]}),(0,t.jsxs)(x.Wu,{children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(f.J,{htmlFor:"calories",children:"Calories (Kcal)"}),(0,t.jsx)(u.p,{id:"calories",type:"number",...E.register("calories")}),E.formState.errors.calories&&(0,t.jsx)("p",{className:"text-destructive text-sm mt-1",children:E.formState.errors.calories.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(f.J,{htmlFor:"protein",children:"Prot\xe9ines (g)"}),(0,t.jsx)(u.p,{id:"protein",type:"number",...E.register("protein")}),E.formState.errors.protein&&(0,t.jsx)("p",{className:"text-destructive text-sm mt-1",children:E.formState.errors.protein.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(f.J,{htmlFor:"carbs",children:"Glucides (g)"}),(0,t.jsx)(u.p,{id:"carbs",type:"number",...E.register("carbs")}),E.formState.errors.carbs&&(0,t.jsx)("p",{className:"text-destructive text-sm mt-1",children:E.formState.errors.carbs.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(f.J,{htmlFor:"fat",children:"Lipides (g)"}),(0,t.jsx)(u.p,{id:"fat",type:"number",...E.register("fat")}),E.formState.errors.fat&&(0,t.jsx)("p",{className:"text-destructive text-sm mt-1",children:E.formState.errors.fat.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(f.J,{htmlFor:"fibers",children:"Fibres (g)"}),(0,t.jsx)(u.p,{id:"fibers",type:"number",...E.register("fibers")}),E.formState.errors.fibers&&(0,t.jsx)("p",{className:"text-destructive text-sm mt-1",children:E.formState.errors.fibers.message})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(f.J,{children:"Ingr\xe9dients"}),w.map((e,r)=>(0,t.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,t.jsx)(u.p,{placeholder:"Nom de l'ingr\xe9dient",value:e.name,onChange:e=>D(r,"name",e.target.value),className:"flex-grow"}),(0,t.jsx)(u.p,{type:"number",placeholder:"g",value:e.grams,onChange:e=>D(r,"grams",Number(e.target.value)),className:"w-24"}),(0,t.jsx)(d.$,{variant:"ghost",size:"icon",onClick:()=>$(r),children:(0,t.jsx)(P.A,{className:"w-4 h-4 text-destructive"})})]},r)),(0,t.jsxs)(d.$,{type:"button",variant:"outline",size:"sm",onClick:()=>{k([...w,{name:"",grams:0}])},className:"mt-2",children:[(0,t.jsx)(B.A,{className:"mr-2 h-4 w-4"})," Ajouter un ingr\xe9dient"]})]})]})]}),(0,t.jsxs)(d.$,{type:"submit",size:"lg",className:"w-full h-12 bg-secondary text-white hover:bg-secondary/90",disabled:j,children:[j?(0,t.jsx)(T.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,t.jsx)(q.A,{className:"mr-2"}),j?"Sauvegarde en cours...":"Sauvegarder le Repas"]})]})}},62523:(e,r,s)=>{s.d(r,{p:()=>l});var t=s(95155),a=s(12115),i=s(59434);let l=a.forwardRef((e,r)=>{let{className:s,type:a,...l}=e;return(0,t.jsx)("input",{type:a,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:r,...l})});l.displayName="Input"},68938:(e,r,s)=>{s.d(r,{A:()=>t});let t=(0,s(31291).A)("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]])},85057:(e,r,s)=>{s.d(r,{J:()=>o});var t=s(95155),a=s(12115),i=s(44167),l=s(63999),n=s(59434);let c=(0,l.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)(i.b,{ref:r,className:(0,n.cn)(c(),s),...a})});o.displayName=i.b.displayName},89578:(e,r,s)=>{s.d(r,{A:()=>t});let t=(0,s(31291).A)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])}}]);
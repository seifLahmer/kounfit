(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6211],{20969:(e,t,r)=>{"use strict";r.d(t,{Kv:()=>c,L$:()=>l,Vd:()=>d,vr:()=>u,wH:()=>o});var a=r(7334),s=r(56104),i=r(22024);let n="orders";async function o(e){let t=(0,a.wP)(s.db);try{let r=[...new Set(e.items.map(e=>e.catererId))],o=e.items.map(e=>({mealId:e.mealId,mealName:e.mealName,quantity:e.quantity,unitPrice:e.unitPrice,catererId:e.catererId,imageUrl:e.imageUrl})),d=e.items.map(e=>{let{mealId:t,mealName:r,quantity:a,unitPrice:s,catererId:i,...n}=e;return n}),l={...e,items:o,status:"pending",orderDate:(0,a.O5)(),deliveryDate:(0,a.O5)(),deliveryTime:35,catererIds:r},c=(0,a.H9)((0,a.rJ)(s.db,n));t.set(c,l);let u=(0,a.H9)(s.db,"users",e.clientId),f=new Date().toISOString().split("T")[0];t.update(u,{["dailyIntake.".concat(f)]:(0,a.hq)(...d)}),await t.commit();let m="Vous avez une nouvelle commande #".concat(c.id.substring(0,5)," de ").concat(e.clientName,".");for(let e of r)await (0,i.UI)(e,m);return c.id}catch(e){throw console.error("Error placing order: ",e),Error("Could not place the order.")}}async function d(){try{let e=(0,a.rJ)(s.db,n),t=(0,a.P)(e,(0,a.My)("orderDate","desc")),r=await (0,a.GG)(t),i=[];return r.forEach(e=>{let t=e.data(),r={id:e.id,...t,orderDate:t.orderDate instanceof a.Dc?t.orderDate.toDate():new Date,deliveryDate:t.deliveryDate instanceof a.Dc?t.deliveryDate.toDate():new Date};i.push(r)}),i}catch(e){throw console.error("Error fetching all orders: ",e),Error("Could not fetch orders.")}}async function l(e){try{let t=(0,a.rJ)(s.db,n),r=(0,a.P)(t,(0,a._M)("catererIds","array-contains",e)),i=await (0,a.GG)(r),o=[];return i.forEach(e=>{let t=e.data(),r={id:e.id,...t,orderDate:t.orderDate instanceof a.Dc?t.orderDate.toDate():new Date,deliveryDate:t.deliveryDate instanceof a.Dc?t.deliveryDate.toDate():new Date};o.push(r)}),o.sort((e,t)=>t.orderDate.getTime()-e.orderDate.getTime()),o}catch(e){throw console.error("Error fetching orders by caterer: ",e),Error("Could not fetch orders.")}}async function c(e,t,r){let o=(0,a.H9)(s.db,n,e);try{let s=await (0,a.x7)(o);if(!s.exists())throw Error("Order not found.");let n=s.data(),d={status:t};"ready_for_delivery"===t&&r&&(d.deliveryPersonId=r),"delivered"===t&&(d.deliveryDate=(0,a.O5)()),await (0,a.mZ)(o,d);let l={in_preparation:"est en cours de pr\xe9paration",ready_for_delivery:"est pr\xeate et a \xe9t\xe9 assign\xe9e \xe0 un livreur.",delivered:"a \xe9t\xe9 livr\xe9e",cancelled:"a \xe9t\xe9 annul\xe9e"};if(t in l){let r="Votre commande #".concat(e.substring(0,5),"... ").concat(l[t],".");await (0,i.UI)(n.clientId,r)}if("ready_for_delivery"===t&&r){let t="Une nouvelle livraison vous a \xe9t\xe9 assign\xe9e : Commande #".concat(e.substring(0,5),"...");await (0,i.UI)(r,t)}}catch(e){throw console.error("Error updating order status: ",e),Error("Could not update the order status.")}}async function u(e,t){if(!t||0===t.length)return[];try{let r=(0,a.rJ)(s.db,n),i=(0,a.P)(r,(0,a._M)("deliveryPersonId","==",e),(0,a._M)("status","in",t)),o=await (0,a.GG)(i),d=[];return o.forEach(e=>{let t=e.data();d.push({id:e.id,...t,orderDate:t.orderDate instanceof a.Dc?t.orderDate.toDate():new Date,deliveryDate:t.deliveryDate instanceof a.Dc?t.deliveryDate.toDate():new Date})}),d.sort((e,t)=>t.orderDate.getTime()-e.orderDate.getTime()),d}catch(e){throw console.error("Error fetching 'my deliveries':",e),Error("Could not fetch assigned deliveries.")}}},22024:(e,t,r)=>{"use strict";r.d(t,{Tr:()=>o,UI:()=>n,bA:()=>d});var a=r(7334),s=r(56104);let i="notifications";async function n(e,t){try{await (0,a.gS)((0,a.rJ)(s.db,i),{userId:e,message:t,isRead:!1,createdAt:(0,a.O5)()})}catch(e){console.error("Error creating notification: ",e)}}async function o(e){try{let t=(0,a.rJ)(s.db,i),r=(0,a.P)(t,(0,a._M)("userId","==",e)),n=await (0,a.GG)(r),o=[];return n.forEach(e=>{let t=e.data();o.push({id:e.id,...t,createdAt:t.createdAt instanceof a.Dc?t.createdAt.toDate():new Date})}),o.sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime()),o.slice(0,20)}catch(e){throw console.error("Error fetching notifications: ",e),Error("Could not fetch notifications.")}}async function d(e){try{let t=(0,a.H9)(s.db,i,e);await (0,a.mZ)(t,{isRead:!0})}catch(e){throw console.error("Error marking notification as read: ",e),Error("Could not update the notification.")}}},30285:(e,t,r)=>{"use strict";r.d(t,{$:()=>l,r:()=>d});var a=r(95155),s=r(12115),i=r(46057),n=r(63999),o=r(59434);let d=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),l=s.forwardRef((e,t)=>{let{className:r,variant:s,size:n,asChild:l=!1,...c}=e,u=l?i.DX:"button";return(0,a.jsx)(u,{className:(0,o.cn)(d({variant:s,size:n,className:r})),ref:t,...c})});l.displayName="Button"},39956:(e,t,r)=>{Promise.resolve().then(r.bind(r,46265))},46265:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>y});var a=r(95155),s=r(12115),i=r(66695),n=r(30285),o=r(91394),d=r(23901),l=r(41630),c=r(6723),u=r(19249),f=r(55401),m=r(20969),h=r(56104),p=r(87481),v=r(7334);function y(){let[e,t]=(0,s.useState)([]),[r,y]=(0,s.useState)(null),[g,x]=(0,s.useState)(!0),{toast:w}=(0,p.dj)(),b=async()=>{let e=h.j2.currentUser;if(e){x(!0);try{let r=(0,v.H9)(h.db,"deliveryPeople",e.uid),a=await (0,v.x7)(r);if(a.exists()){let r={uid:a.id,...a.data()};y(r);let s=await (0,m.vr)(e.uid,["ready_for_delivery","in_delivery"]);t(s)}else w({title:"Erreur",description:"Profil livreur non trouv\xe9.",variant:"destructive"})}catch(e){console.error(e),w({title:"Erreur",description:e.message||"Impossible de charger les donn\xe9es.",variant:"destructive"})}finally{x(!1)}}};(0,s.useEffect)(()=>{let e=h.j2.onAuthStateChanged(e=>{e&&b()});return()=>e()},[]);let D=async e=>{try{await (0,m.Kv)(e,"delivered"),w({title:"Livraison termin\xe9e!",description:"La commande a \xe9t\xe9 marqu\xe9e comme livr\xe9e.",action:(0,a.jsx)(d.A,{className:"text-green-500"})}),b()}catch(e){w({title:"Erreur",description:"Impossible de finaliser la livraison.",variant:"destructive"})}},N=e=>{let t=encodeURIComponent(e);window.open("https://www.google.com/maps/dir/?api=1&destination=".concat(t),"_blank")};return(0,a.jsxs)("div",{className:"p-4 space-y-6",children:[(0,a.jsxs)("header",{className:"p-4 flex justify-between items-center bg-primary text-white rounded-lg",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold font-heading",children:"Mes Livraisons"}),(0,a.jsx)(l.A,{})]}),g?(0,a.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,a.jsx)(c.A,{className:"w-12 h-12 animate-spin text-primary"})}):(0,a.jsx)("div",{className:"space-y-6",children:(0,a.jsx)("div",{children:e.length>0?e.map(e=>(0,a.jsxs)(i.Zp,{className:"mb-4 shadow-lg transition-transform duration-300 hover:scale-105",children:[(0,a.jsxs)(i.aR,{className:"flex flex-row items-center justify-between pb-2",children:[(0,a.jsxs)(i.ZB,{className:"text-lg",children:["Commande #",e.id.substring(0,5)]}),(0,a.jsxs)("span",{className:"font-bold text-primary",children:[e.totalPrice.toFixed(2)," DT"]})]}),(0,a.jsxs)(i.Wu,{children:[(0,a.jsxs)("div",{className:"flex items-start gap-4",children:[(0,a.jsx)(o.eu,{children:(0,a.jsx)(o.q5,{children:e.clientName.charAt(0)})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-semibold",children:e.clientName}),(0,a.jsxs)("div",{className:"flex items-center text-sm text-muted-foreground gap-2 mt-1 cursor-pointer hover:text-primary",onClick:()=>N(e.deliveryAddress),children:[(0,a.jsx)(u.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"underline",children:e.deliveryAddress})]})]})]}),(0,a.jsxs)(n.$,{className:"w-full mt-4 bg-secondary hover:bg-secondary/90",onClick:()=>D(e.id),children:[(0,a.jsx)(d.A,{className:"mr-2 h-4 w-4"})," Marquer comme livr\xe9e"]})]})]},e.id)):(0,a.jsx)(i.Zp,{className:"shadow-lg transition-transform duration-300 hover:scale-105",children:(0,a.jsxs)(i.Wu,{className:"flex flex-col items-center justify-center h-48 text-muted-foreground",children:[(0,a.jsx)(f.A,{className:"w-12 h-12 mb-4"}),(0,a.jsx)("p",{className:"text-lg font-semibold",children:"Aucune commande assign\xe9e"}),(0,a.jsx)("p",{className:"text-center text-sm",children:"Vous n'avez pas de livraison en cours pour le moment."})]})})})})]})}},56104:(e,t,r)=>{"use strict";let a,s,i,n,o;r.d(t,{IG:()=>n,db:()=>i,hJ:()=>o,j2:()=>s});var d=r(49868),l=r(46151),c=r(7334),u=r(46068);a=0===(0,d.Dk)().length?(0,d.Wp)({apiKey:"AIzaSyDhJXy_8JJ89CUMhj8iyldXvps_H5R7AHI",authDomain:"fithelath.firebaseapp.com",projectId:"fithelath",storageBucket:"fithelath.firebasestorage.app",messagingSenderId:"98685881966",appId:"1:98685881966:web:99d8147fde3b9b5847a07f"}):(0,d.Sx)(),s=(0,l.xI)(a),(0,l.oM)(s,l.F0).catch(e=>{console.error("Firebase persistence error:",e)}),i=(0,c.aU)(a),n=(0,u.c7)(a),o=new l.HF},59434:(e,t,r)=>{"use strict";r.d(t,{cn:()=>i});var a=r(61219),s=r(6967);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.QP)((0,a.$)(t))}},66695:(e,t,r)=>{"use strict";r.d(t,{BT:()=>c,Wu:()=>u,ZB:()=>l,Zp:()=>o,aR:()=>d});var a=r(95155),s=r(12115),i=r(46057),n=r(59434);let o=s.forwardRef((e,t)=>{let{className:r,as:s="div",asChild:o=!1,...d}=e,l=o?i.DX:s;return(0,a.jsx)(l,{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground",r),...d})});o.displayName="Card";let d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",r),...s})});d.displayName="CardHeader";let l=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("h3",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",r),...s})});l.displayName="CardTitle";let c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("p",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",r),...s})});c.displayName="CardDescription";let u=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",r),...s})});u.displayName="CardContent",s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",r),...s})}).displayName="CardFooter"},87481:(e,t,r)=>{"use strict";r.d(t,{dj:()=>f});var a=r(12115);let s=0,i=new Map,n=e=>{if(i.has(e))return;let t=setTimeout(()=>{i.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);i.set(e,t)},o=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:r}=t;return r?n(r):e.toasts.forEach(e=>{n(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},d=[],l={toasts:[]};function c(e){l=o(l,e),d.forEach(e=>{e(l)})}function u(e){let{...t}=e,r=(s=(s+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>c({type:"DISMISS_TOAST",toastId:r});return c({type:"ADD_TOAST",toast:{...t,id:r,open:!0,onOpenChange:e=>{e||a()}}}),{id:r,dismiss:a,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:r}})}}function f(){let[e,t]=a.useState(l);return a.useEffect(()=>(d.push(t),()=>{let e=d.indexOf(t);e>-1&&d.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},91394:(e,t,r)=>{"use strict";r.d(t,{BK:()=>d,eu:()=>o,q5:()=>l});var a=r(95155),s=r(12115),i=r(95419),n=r(59434);let o=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(i.bL,{ref:t,className:(0,n.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",r),...s})});o.displayName=i.bL.displayName;let d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(i._V,{ref:t,className:(0,n.cn)("aspect-square h-full w-full",r),...s})});d.displayName=i._V.displayName;let l=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(i.H4,{ref:t,className:(0,n.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",r),...s})});l.displayName=i.H4.displayName}},e=>{var t=t=>e(e.s=t);e.O(0,[310,1951,4595,8561,5588,8441,1684,7358],()=>t(39956)),_N_E=e.O()}]);
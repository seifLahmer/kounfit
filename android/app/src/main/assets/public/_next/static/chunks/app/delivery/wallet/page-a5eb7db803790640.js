(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4925],{6723:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(31291).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},15594:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(31291).A)("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]])},20969:(e,t,r)=>{"use strict";r.d(t,{Kv:()=>c,L$:()=>l,Vd:()=>d,vr:()=>u,wH:()=>o});var a=r(7334),s=r(56104),i=r(22024);let n="orders";async function o(e){let t=(0,a.wP)(s.db);try{let r=[...new Set(e.items.map(e=>e.catererId))],o=e.items.map(e=>({mealId:e.mealId,mealName:e.mealName,quantity:e.quantity,unitPrice:e.unitPrice,catererId:e.catererId,imageUrl:e.imageUrl})),d=e.items.map(e=>{let{mealId:t,mealName:r,quantity:a,unitPrice:s,catererId:i,...n}=e;return n}),l={...e,items:o,status:"pending",orderDate:(0,a.O5)(),deliveryDate:(0,a.O5)(),deliveryTime:35,catererIds:r},c=(0,a.H9)((0,a.rJ)(s.db,n));t.set(c,l);let u=(0,a.H9)(s.db,"users",e.clientId),m=new Date().toISOString().split("T")[0];t.update(u,{["dailyIntake.".concat(m)]:(0,a.hq)(...d)}),await t.commit();let h="Vous avez une nouvelle commande #".concat(c.id.substring(0,5)," de ").concat(e.clientName,".");for(let e of r)await (0,i.UI)(e,h);return c.id}catch(e){throw console.error("Error placing order: ",e),Error("Could not place the order.")}}async function d(){try{let e=(0,a.rJ)(s.db,n),t=(0,a.P)(e,(0,a.My)("orderDate","desc")),r=await (0,a.GG)(t),i=[];return r.forEach(e=>{let t=e.data(),r={id:e.id,...t,orderDate:t.orderDate instanceof a.Dc?t.orderDate.toDate():new Date,deliveryDate:t.deliveryDate instanceof a.Dc?t.deliveryDate.toDate():new Date};i.push(r)}),i}catch(e){throw console.error("Error fetching all orders: ",e),Error("Could not fetch orders.")}}async function l(e){try{let t=(0,a.rJ)(s.db,n),r=(0,a.P)(t,(0,a._M)("catererIds","array-contains",e)),i=await (0,a.GG)(r),o=[];return i.forEach(e=>{let t=e.data(),r={id:e.id,...t,orderDate:t.orderDate instanceof a.Dc?t.orderDate.toDate():new Date,deliveryDate:t.deliveryDate instanceof a.Dc?t.deliveryDate.toDate():new Date};o.push(r)}),o.sort((e,t)=>t.orderDate.getTime()-e.orderDate.getTime()),o}catch(e){throw console.error("Error fetching orders by caterer: ",e),Error("Could not fetch orders.")}}async function c(e,t,r){let o=(0,a.H9)(s.db,n,e);try{let s=await (0,a.x7)(o);if(!s.exists())throw Error("Order not found.");let n=s.data(),d={status:t};"ready_for_delivery"===t&&r&&(d.deliveryPersonId=r),"delivered"===t&&(d.deliveryDate=(0,a.O5)()),await (0,a.mZ)(o,d);let l={in_preparation:"est en cours de pr\xe9paration",ready_for_delivery:"est pr\xeate et a \xe9t\xe9 assign\xe9e \xe0 un livreur.",delivered:"a \xe9t\xe9 livr\xe9e",cancelled:"a \xe9t\xe9 annul\xe9e"};if(t in l){let r="Votre commande #".concat(e.substring(0,5),"... ").concat(l[t],".");await (0,i.UI)(n.clientId,r)}if("ready_for_delivery"===t&&r){let t="Une nouvelle livraison vous a \xe9t\xe9 assign\xe9e : Commande #".concat(e.substring(0,5),"...");await (0,i.UI)(r,t)}}catch(e){throw console.error("Error updating order status: ",e),Error("Could not update the order status.")}}async function u(e,t){if(!t||0===t.length)return[];try{let r=(0,a.rJ)(s.db,n),i=(0,a.P)(r,(0,a._M)("deliveryPersonId","==",e),(0,a._M)("status","in",t)),o=await (0,a.GG)(i),d=[];return o.forEach(e=>{let t=e.data();d.push({id:e.id,...t,orderDate:t.orderDate instanceof a.Dc?t.orderDate.toDate():new Date,deliveryDate:t.deliveryDate instanceof a.Dc?t.deliveryDate.toDate():new Date})}),d.sort((e,t)=>t.orderDate.getTime()-e.orderDate.getTime()),d}catch(e){throw console.error("Error fetching 'my deliveries':",e),Error("Could not fetch assigned deliveries.")}}},22024:(e,t,r)=>{"use strict";r.d(t,{Tr:()=>o,UI:()=>n,bA:()=>d});var a=r(7334),s=r(56104);let i="notifications";async function n(e,t){try{await (0,a.gS)((0,a.rJ)(s.db,i),{userId:e,message:t,isRead:!1,createdAt:(0,a.O5)()})}catch(e){console.error("Error creating notification: ",e)}}async function o(e){try{let t=(0,a.rJ)(s.db,i),r=(0,a.P)(t,(0,a._M)("userId","==",e)),n=await (0,a.GG)(r),o=[];return n.forEach(e=>{let t=e.data();o.push({id:e.id,...t,createdAt:t.createdAt instanceof a.Dc?t.createdAt.toDate():new Date})}),o.sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime()),o.slice(0,20)}catch(e){throw console.error("Error fetching notifications: ",e),Error("Could not fetch notifications.")}}async function d(e){try{let t=(0,a.H9)(s.db,i,e);await (0,a.mZ)(t,{isRead:!0})}catch(e){throw console.error("Error marking notification as read: ",e),Error("Could not update the notification.")}}},31291:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var a=r(12115);let s=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),i=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let o=(0,a.forwardRef)((e,t)=>{let{color:r="currentColor",size:s=24,strokeWidth:o=2,absoluteStrokeWidth:d,className:l="",children:c,iconNode:u,...m}=e;return(0,a.createElement)("svg",{ref:t,...n,width:s,height:s,stroke:r,strokeWidth:d?24*Number(o)/Number(s):o,className:i("lucide",l),...m},[...u.map(e=>{let[t,r]=e;return(0,a.createElement)(t,r)}),...Array.isArray(c)?c:[c]])}),d=(e,t)=>{let r=(0,a.forwardRef)((r,n)=>{let{className:d,...l}=r;return(0,a.createElement)(o,{ref:n,iconNode:t,className:i("lucide-".concat(s(e)),d),...l})});return r.displayName="".concat(e),r}},56104:(e,t,r)=>{"use strict";let a,s,i,n,o;r.d(t,{IG:()=>n,db:()=>i,hJ:()=>o,j2:()=>s});var d=r(49868),l=r(46151),c=r(7334),u=r(46068);a=0===(0,d.Dk)().length?(0,d.Wp)({apiKey:"AIzaSyDhJXy_8JJ89CUMhj8iyldXvps_H5R7AHI",authDomain:"fithelath.firebaseapp.com",projectId:"fithelath",storageBucket:"fithelath.firebasestorage.app",messagingSenderId:"98685881966",appId:"1:98685881966:web:99d8147fde3b9b5847a07f"}):(0,d.Sx)(),s=(0,l.xI)(a),(0,l.oM)(s,l.F0).catch(e=>{console.error("Firebase persistence error:",e)}),i=(0,c.aU)(a),n=(0,u.c7)(a),o=new l.HF},59434:(e,t,r)=>{"use strict";r.d(t,{cn:()=>i});var a=r(61219),s=r(6967);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.QP)((0,a.$)(t))}},66695:(e,t,r)=>{"use strict";r.d(t,{BT:()=>c,Wu:()=>u,ZB:()=>l,Zp:()=>o,aR:()=>d});var a=r(95155),s=r(12115),i=r(46057),n=r(59434);let o=s.forwardRef((e,t)=>{let{className:r,as:s="div",asChild:o=!1,...d}=e,l=o?i.DX:s;return(0,a.jsx)(l,{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground",r),...d})});o.displayName="Card";let d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",r),...s})});d.displayName="CardHeader";let l=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("h3",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",r),...s})});l.displayName="CardTitle";let c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("p",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",r),...s})});c.displayName="CardDescription";let u=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",r),...s})});u.displayName="CardContent",s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",r),...s})}).displayName="CardFooter"},87481:(e,t,r)=>{"use strict";r.d(t,{dj:()=>m});var a=r(12115);let s=0,i=new Map,n=e=>{if(i.has(e))return;let t=setTimeout(()=>{i.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);i.set(e,t)},o=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:r}=t;return r?n(r):e.toasts.forEach(e=>{n(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},d=[],l={toasts:[]};function c(e){l=o(l,e),d.forEach(e=>{e(l)})}function u(e){let{...t}=e,r=(s=(s+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>c({type:"DISMISS_TOAST",toastId:r});return c({type:"ADD_TOAST",toast:{...t,id:r,open:!0,onOpenChange:e=>{e||a()}}}),{id:r,dismiss:a,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:r}})}}function m(){let[e,t]=a.useState(l);return a.useEffect(()=>(d.push(t),()=>{let e=d.indexOf(t);e>-1&&d.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},92e3:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>f});var a=r(95155),s=r(12115),i=r(66695),n=r(15594),o=r(6723);let d=(0,r(31291).A)("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]);var l=r(20969),c=r(56104),u=r(87481),m=r(58295),h=r(59171);function f(){let[e,t]=(0,s.useState)([]),[r,f]=(0,s.useState)(!0),{toast:p}=(0,u.dj)();(0,s.useEffect)(()=>{let e=async()=>{let e=c.j2.currentUser;if(e){f(!0);try{let r=await (0,l.vr)(e.uid,["delivered"]);t(r)}catch(e){p({title:"Erreur",description:"Impossible de charger l'historique des livraisons.",variant:"destructive"})}finally{f(!1)}}},r=c.j2.onAuthStateChanged(t=>{t&&e()});return()=>r()},[p]);let x=7*e.length;return(0,a.jsxs)("div",{className:"p-4 space-y-6",children:[(0,a.jsxs)("header",{className:"p-4 flex items-center gap-4 bg-primary text-white rounded-lg",children:[(0,a.jsx)(n.A,{className:"w-8 h-8"}),(0,a.jsx)("h1",{className:"text-2xl font-bold font-heading",children:"Mon Portefeuille"})]}),r?(0,a.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,a.jsx)(o.A,{className:"w-12 h-12 animate-spin text-primary"})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)(i.Zp,{className:"shadow-lg transition-transform duration-300 hover:scale-105",children:[(0,a.jsxs)(i.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(i.ZB,{className:"text-sm font-medium",children:"Chiffre d'affaires"}),(0,a.jsx)(n.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(i.Wu,{children:[(0,a.jsxs)("div",{className:"text-2xl font-bold",children:[x.toFixed(2)," DT"]}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Bas\xe9 sur ",e.length," livraisons"]})]})]}),(0,a.jsxs)(i.Zp,{className:"shadow-lg transition-transform duration-300 hover:scale-105",children:[(0,a.jsxs)(i.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(i.ZB,{className:"text-sm font-medium",children:"Livraisons termin\xe9es"}),(0,a.jsx)(d,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsxs)(i.Wu,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:e.length}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Total de commandes livr\xe9es"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Historique des livraisons"}),e.length>0?(0,a.jsx)("div",{className:"space-y-4",children:e.map(e=>(0,a.jsx)(i.Zp,{className:"shadow-lg transition-transform duration-300 hover:scale-105",children:(0,a.jsx)(i.Wu,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"font-semibold",children:["Commande #",e.id.substring(0,5)]}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Client: ",e.clientName]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"font-bold text-green-600",children:["7.00"," DT"]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground capitalize",children:(0,m.GP)(e.deliveryDate,"d MMM yyyy",{locale:h.fr})})]})]})})},e.id))}):(0,a.jsx)(i.Zp,{className:"shadow-lg transition-transform duration-300 hover:scale-105",children:(0,a.jsx)(i.Wu,{className:"p-8 text-center text-muted-foreground",children:(0,a.jsx)("p",{children:"Aucune livraison termin\xe9e pour le moment."})})})]})]})]})}},92222:(e,t,r)=>{Promise.resolve().then(r.bind(r,92e3))}},e=>{var t=t=>e(e.s=t);e.O(0,[310,1951,4595,8561,5547,8295,8441,1684,7358],()=>t(92222)),_N_E=e.O()}]);
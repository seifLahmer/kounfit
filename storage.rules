
rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    
    // Rules for profile images
    // Allow users to read and write their own profile images.
    // The path is structured as /profile-images/{userId}/{fileName}
    match /profile-images/{userId}/{allPaths=**} {
      // Allow read access to anyone (profile pictures are often public)
      allow read;
      
      // Allow write (create, update, delete) access only if the user is authenticated
      // and the userId in the path matches their own UID.
      // This prevents a user from overwriting another user's profile image.
      allow write: if request.auth != null && request.auth.uid == userId;
    }

    // You can add more rules for other paths here.
    // For example, if you had meal images:
    // match /meal-images/{allPaths=**} {
    //   allow read; // Allow public read for meal images
    //   // Add write restrictions (e.g., only admins) if necessary
    //   allow write: if request.auth != null && get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
    // }
  }
}
